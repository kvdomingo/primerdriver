version: 2.1

orbs:
    python: circleci/python@0.2.1

jobs:
    build-and-test:
        executor: python/default
        steps:
            - checkout
            - python/load-cache
            - python/install-deps
            - python/save-cache
            - run:
                command: python -m pip install coverage
                name: Install coverage
            - run:
                command: python manage.py test
                name: Test
            - run:
                command: coverage run --source='.' manage.py test
                name: Coverage
            - run:
                command: coverage xml
                name: Generate coverage report
            - run:
                command: codecov
                name: Upload coverage report

workflows:
    main:
        jobs:
            - build-and-test
